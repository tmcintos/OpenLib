/*  -*- LPC -*-  */
// cmd_module.c:  Tim McIntosh (astasia@iastate.edu)
//
// functions for getting various things from the command line
//
// Inspired by VikingMUD and other things...
//
// 01.25.96  Tim@UltraLib  Updated format of _main() function.  Made
//                         incompatible with previous versions.

int main(string arguments);
int flag(string flag);

int _main(string *argv, string *argv2);

string *flags;                  //  array of flags passed on command line

// Function:  main()
// Arguments:  command line as taken from player
// Returns:  value returned by _main()
//
// This main() function sits in front of the _main() function to strip
// out flags and separate all the words on the command line

int
main(string arguments)
{
  string *argv = ({});          //  array of verb + all args passed to command
  string *argv2 = ({});         // array of all non-flag arguments

  flags = ({});

  if(arguments) 
    argv = explode(arguments, " ");

  argv = ({ query_verb() }) + argv;

  for(int i=0; i < sizeof(argv); i++) {         // get array of flags
    if(argv[i][0] == '-') {
      if(argv[i][1] != '-')
	flags += explode(argv[i], "");          // normal flags
      else
	flags += ({ argv[i][2..] });            // word flags passed as --word
    } else if(i != 0) {
      argv2 += ({ argv[i] });                   // get words that aren't flags
    }
  }

  // Might as well catch this here

  if(flag("help")) {
    printf("Help for %s:\n\n", argv[0]);
    write(this_object()->help());
    write("\n");
    return 1;
  }

  return _main(argv, argv2);
}

// Function:  flag()
// Arguments:  a flag ex: "l", "r", "help", etc.
// Returns:  1 if flag was passed
//           0 if flag was not passed

int
flag(string flag)
{
  return member_array(flag, flags) != -1;
}
