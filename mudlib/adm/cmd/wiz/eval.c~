#include <command.h>
#include <dirs.h>

#define TFILE TMP_DIR "/tmp_eval_file"

int
main(string arg)
{
  seteuid(getuid(this_player()));
  if(arg == "" || !arg)
    return notify_fail("usage: eval <lpc code>\n");

  /* clean up first */
  if (file_size(TFILE ".c") != -1)
    rm (TFILE ".c");
  if (find_object(TFILE))
    destruct(find_object(TFILE));

  write_file(TFILE ".c", sprintf("#include <mudlib.h>\n"
				 "#include <daemons.h>\n"
				 "#include <net/daemons.h>\n"
				 "#undef unguarded\n"
				 "mixed eval() { \n"
				 "  object me = this_player();\n"
				 "  %s; }\n", arg));
  printf("Result = %O\n", TFILE->eval());
  return 1;
}
